# 因果判断的统计方法

## 1 引言

探求事物之间的因果关系是哲学、自然科学和社会科学等众多研究所追求的终极目标。古希腊哲学家德谟克利特（约公元前400年）认为：发现一个因果关系胜过做国王。培根（1561--1626年）提出"知识就是力量"，并认为"真正的知识是根据因果关系得到的知识"。探索并发现因果关系及其方法论的研究，伴随人类社会的发展而不断精深，成为经久不衰的挑战。如何根据观测和试验探究事物之间的因果关系，这个问题自东西方古代哲学到现代科学，已经困惑了人类数千年。因果关系与相关关系是两个不同的概念。即使两个变量有相关关系也可能没有因果关系；相反地，它们没有相关关系也可能有因果关系。十九世纪末，统计学家提出了各种相关关系的形式化度量，最具有代表性的是Pearson相关系数。一个多世纪以来，统计学中关于相关关系的研究取得了令人瞩目的成就，而关于因果关系的研究则进展缓慢。正如Holland(1986)指出的那样：涉及因果推断的问题自始就缠住了统计学前进的步伐。2011年图灵奖获得者Pearl(2009)认为：在过去的一个世纪中，许多科学发现被推迟是由于缺少描述因果的数学语言。近年来，探索因果关系的研究越来越激励着统计学者和计算机学者，在统计领域中对因果推断的兴趣正在复兴(Lauritzen,2004)。2008年以来，在国际机器学习会议和期刊中组织了多次因果挑战的Workshops(Guyon et al.,2008)和专题论文(Spirtes,2010)。在大数据时代，不仅要紧盯事物之间的相关关系，更应该挖掘蕴藏在大数据中的因果关系(DARPA, Big Mechanism Program)例如，某超市发现顾客买尿布与买啤酒有很大的相关性，实际上二者没有因果关系，而出现这个相关性的原因是在家照顾婴儿的主妇常让丈夫去超市买尿布，这些丈夫买尿布的同时会顺便买啤酒。如果这些主妇改为自己在网上买尿布的话，将不能期望她们的丈夫同时会买啤酒。

在科学研究的各个领域都存在因果推断的挑战问题。在经济学中，诺贝尔经济学奖获得者Heckman(2008)提出了政策评价中的三个因果推断的挑战问题：
-   评价历史上出现的干预对结果的影响；
-   预测在一个环境中曾执行过的干预在其他环境中的影响；
-   预测历史上从没有经历过的干预在各种环境中的影响。
从时间序列预测的角度，Granger(1969)中提出了因果关系的定义：如果利用$X$能更好地预测$Y$，那么$X$是$Y$的原因。这个定义不能描述真正的因果关系，实际上是相关关系。例如，看到闪电可以预测雷声，而闪电却不是雷声的真正原因。相关关系是"预测"的基础，而因果关系是"决策"的基础。

目前，因果推断采用的两个主要模型是潜在结果模型(Neyman1923;Rubin,1974)和因果网络模型(Pearl,1988;2009b)。潜在结果模型给出了因果作用的数学定义。该模型主要用在原因和结果变量已知的前提下，定量评价原因变量对结果变量的因果作用。因果网络模型是描述数据产生机制和外部干预的形式化语言。因果网络是将贝叶斯网络加上外部干预，用来定义外部干预的因果作用和描述多个变量之间的因果关系。利用因果网络不仅能定量评价因果作用，还能定性确定混杂因素，用于从数据挖掘因果关系。

本文第2节介绍因果推断的潜在结果模型，因果作用的可识别性，和随机化试验；第3节介绍观察性研究和混杂因素，以及混杂因素完全观测时的因果推断方法；第4节介绍存在未观测的混杂因素时因果作用的估计方法；第5节介绍替代指标悖论和确定替代指标的准则；第6节介绍因果网络模型和结构学习的算法。最后，在第7节我们展望因果推断在现代大数据研究中的前景。

## 2 潜在结果模型

### 2.1 潜在结果和因果作用的定义

两个变量$X$和$Y$的相关系数可以用$X$和$Y$的联合分布的函数表示。例如，Pearson相关系数表示为$\rho(X,Y)=\sigma_{xy}/(\sigma_x\sigma_y)$,其中，$\sigma_{xy}$是$X,Y$的协方差，$\sigma_x,\sigma_y$分别是$X,Y$的标准差。但是，如何形式化表示两个变量$X$和$Y$的因果作用的度量呢？用观测变量$X$和$Y$的联合分布的函数怎么也不能清楚地定义因果作用。

统计学家利用潜在结果给出了因果作用的的形式化定义。利用潜在结果模型，Neyman(1923)针对试验性研究(experimental studies)给出了因果作用的数学定义,Rubin(1974)将这一定义推广到观察性研究(observational studies)。潜在结果模型通常需要假定个体处理值稳定(stable unit treatment value assumption，SUTVA)：个体$i$的潜在结果不受其他个体的处理的影响，并且对每个个体和每一种处理只有一个潜在结果，详细讨论见Rubin(1980)。考虑一个二值处理或暴露变量(treatment/exposure)，$X=1$代表处理组，$0$代表对照组.在接受处理分配$X=x$后的结果变量为$Y_x$,表示假如接受处理$X=x$后的结果，称为潜在结果(potential outcome)。对每个个体，实际观察的结果变量$Y$可以用潜在结果$(Y_1,Y_0)$表示为$Y=XY_1+(1-X)Y_0$。SUTVA假定意味着张三的病是否被治好不受李四是否吃药的影响。这个假定在很多实际问题中不成立，例如，李四获奖，也许会影响其同事张三的工作积极性；周围的朋友打不打流感预防针也许会影响自己得不得流感。这个假定也许是潜在结果模型的重要缺陷之一。目前有一些学者试图利用社会网络方法弥补这个缺陷(Athey et al.,2018;Eckles et al.,2017;Hudgens and Halloran,2008;Liu and Hudgens,2014;Sobel,2006;Tchetgen and VanderWeele,2012)。

因果作用定义为相同个体的潜在结果的比较(Neyman1923;Rubin1974,1978)。个体$i$的因果作用(individual Causal Effect, ICE)定义为：$${\rm ICE}(i) = Y_1(i) - Y_0(i).$$尽管潜在结果模型清楚地定义了个体因果作用，但是，正如赫拉克里塔斯(Heraclitus，古希腊哲学家)所指出的那样：你不可能两次踏入相同的河。对于每个个体$i$,通常不可能既观测到$Y_1(i)$，又观测到$Y_{0}(i)$。因此，个体因果作用通常是不能从观测数据推断的。尽管如此，有一些学者试图探讨个体因果作用的统计推断方法，这一般需要较强的模型假定。目前，个体化治疗和精准治疗也是试图推断个体因果作用或同质个体人群的因果作用(Murphy,2003;Su et al.,2012;Kleinberg and Hripcsak,2011;Chakraborty and Moodie,2013)。由于对每一个体$i$，$Y_1(i)$和$Y_0(i)$不能同时观测到，因此，因果推断还可以看为是一个缺失数据的问题。

统计学是关心总体的特征，利用潜在结果，还可以定义总体的平均因果作用。

定义2.1  总体的平均因果作用定义为个体因果作用的期望：$${\rm ACE} = E({\rm ICE}) = E(Y_1 - Y_0) = E(Y_1) - E(Y_0).$$

平均因果作用定义为假若所有个体都接受处理$X=1$的平均结果$E(Y_1)$与假若所有个体都接受对照$X=0$的平均结果$E(Y_0)$之差。在实际中不可能让所有的个体都接受处理$X=1$，再接受对照$X=0$；即使这样做，对同一个体$i$，先接受处理$X=x$的潜在结果$Y_x(i)$与后接受处理$X=x$的潜在结果$Y'_x(i)$可能也不一致。

进一步，人们可能关心某个子总体的平均因果作用。例如，某药物对不同人群，如对男性或女性分别的疗效。

定义2.2  令$V$为协变量。定义$V=v$子总体的平均因果作用为$E(Y_1-Y_0 \mid V=v)$。

另外，人们常常关心处理组的因果作用。例如，流行病学家并不关心吸烟对整个人群的因果作用，而只关心吸烟对吸烟人群的因果作用。

定义2.3  处理组的平均因果作用定义为$E(Y_1 - Y_0 \mid X=1)$。

我们称平均因果作用 ${\rm  ACE}=E(Y_1 - Y_0)$ 为可识别的，如果${\rm ACE}$可以由观测变量的分布$pr(X,Y,V)$唯一确定。如果ACE不可识别，则意味着至少存在两个不相等的 ${\rm ACE} \neq {\rm ACE'}$满足观测到的数据。可识别性往往是因果推断中最棘手的问题。为了得到因果作用的可识别性，通常需要有额外的假定。随机化试验是识别因果作用最有效的方法。

### 2.2 随机化试验

统计学家R.A.Fisher给出了识别平均因果作用的方法：随机化试验设计。随机化处理分配$X$给个体$i$，比如抛硬币确定个体$i$
的处理$X$，与潜在结果及协变量的取值无关，可以保证潜在结果$(Y_1, Y_0)$和处理分配$X$独立，即，在随机化分配下，有$(Y_1, Y_0) \ind X$，进而$$E(Y_x)=E(Y\mid X=x), \quad {\rm ACE}=E(Y\mid X=1)-E(Y\mid X=0).$$

在随机化分配下，平均因果作用表示为观测到的结果变量$Y$在处理组$X=1$与对照组 $X=0$ 中期望之差，不再含有潜在结果变量$Y_1$和$Y_0$,因此，它是可识别的。通过分别估计$E(Y\mid X=1)$和$E(Y\mid X=0)$，传统的统计推断方法可以用来推断平均因果作用。例如，用 $t$-检验研究平均因果作用是否为零。随机化试验的理论、设计和实践，见Fisher(1935)。

在实际研究中，随机化试验往往不具备可操作性。例如，研究吸烟对肺癌的作用，不能随机化分配一个人吸烟或不吸。在实际中经常面临的其他问题，例如代价昂贵，个体不依从(noncompliance)等等也都限制了随机化试验的应用。在下两节，我们介绍利用观察性研究推断因果作用的方法。这些方法使用观察性研究得到的数据，通过引入处理分配可忽略性假定，或者辅助变量，比如工具变量(instrumental variable),阴性对照变量(negative control variable)来推断因果作用。

## 3 观察性研究和可忽略性

### 3.1 观察性研究和混杂因素

Cochran(1965) and Chambers(1965)定义观察性研究(observational studies)为根据处理和结果的经验观察推断因果作用的研究，但不能采用有控制的试验，也不能随机地分配处理。观察性研究不再满足随机分配的条件，即$(Y_1,Y_0)\nind X$。在这种情况下如果忽略协变量，仅用随机化试验推断方法估计因果作用就会导致偏差。这个偏差甚至会造成悖论，例如，Yule--Simpson(Yule,1903;Simpson,1951)悖论。解释这个悖论的一个很好的例子是Bickel et al.(1975)关于加利福尼亚大学伯克莱分校的研究生入学中是否存在性别歧视的研究。他们在观测数据中发现男生录取比例高于女生，但是，根据学生申请专业分层后，发现女生的录取率略高于男生。可见，如果没有记录学生的报考专业数据，或者不对此做调整，就会产生完全错误的结论。在这个例子中，申请专业是研究性别对录取率影响的关键因素，称为混杂因素，忽略这样的因素会导致因果作用估计的偏差。

判断和确定哪些变量或因素是混杂因素的问题是因果推断中最基本和关键的问题。判别混杂因素的准则大致分为两大类:可压缩性准则和可比较性准则。可压缩性准则根据相关关系的度量定义混杂因素。如果相关关系的度量受第三个变量的影响，那么该变量为混杂因素。Greenland et al.(1999b)介绍了混杂因素的可压缩性准则。

可比较性准则是基于潜在结果模型来定义混杂偏倚和混杂因素。如果暴露总体的潜在结果$Y_1$和$Y_0$的分布分别与非暴露总体的潜在结果的分布相同(即$pr(Y_1|X=1)=pr(Y_1|X=0)$和$pr(Y_0|X=1)=pr(Y_0|X=0)$，则称暴露总体和非暴露总体是可比较的（或称可交换的），也称为无混杂偏倚。在这种情况下，暴露对结果的平均因果作用${\rm ACE}=E(Y_1) - E(Y_0)$等于暴露组与非暴露组观测结果的期望之差$E(Y|X=1) - E(Y|X=0)$。Miettinen and Cook(1981)利用很多流行病学的案例归纳出判断混杂因素的准则：混杂因素$V$必须同时满足下面两个条件

1.  $V$是一个独立的风险因素，并且

2.  $V$在暴露总体与在非暴露总体中的分布不同。

Kleinbaum et al.(1982)和Greenland and Robins(1986)将混杂因素叙述为：当控制和调整某个变量使混杂偏倚减小时，那么该变量为混杂因素。因果推断的关键问题是，如何推断潜在结果的期望$E(Y_{1-x}|X=x)$。这个期望是反事实的，因为对$X=x$的个体，潜在结果$Y_{1-x}$永远观测不到。一种推断反事实的潜在结果期望的方法称为标准化方法。标准化是指，利用观测的协变量$V$对$X=1-x$组的观测结果$Y$的期望进行调整$\theta_{1-x} = E[E(Y|X=1-x, V)]$。据此，Geng et al.(2002)给出了混杂因素的形式定义：如果利用变量$V$的标准化能减少混杂偏倚，即，$$|E(Y_{1-x}|X=x) - \theta_{1-x}| < |E(Y_{1-x}|X=x) - E(Y|X=1-x)|,$$则称变量$V$为混杂因素。据这个混杂因素的形式化定义，可以证明Miettinen and Cook(1981)的准则（形式化为 $V \nind Y\mid X$ 和 $V \nind X$）是混杂因素的必要条件，但不是充分条件。也就是说，Miettinen and Cook(1981)的准则只能判断哪些变量不是混杂因素，但不能判断哪些是混杂因素。

### 3.2 可忽略性假定

Rosenbaum and Rubin(1983)提出的处理分配机制的可忽略性假定是观察性研究中判断混杂因素和推断因果作用最重要的假定。本文的3.2---3.5节都假定如下的可忽略性成立。

假设3.1（处理分配机制的可忽略性，ignorability of treatment assignment mechanism,简称可忽略性） 令$V$表示观测的协变量，如果满足$(i)$ $(Y_1,Y_0)\ind X\mid V$ 和$(ii)$ $0<\pr(X=1\mid V)<1$，那么称处理分配机制是可忽略的。

可忽略性假定中的条件$(i)$相当于在$V$的每一层做了随机化分配，那么，在$V$的每一层，平均因果作用是可识别的，进而对$V$求期望可以得到总体的平均因果作用，条件$(ii)$要求在。$V$的每一层里接受处理或对照的概率大于零，这是为了保证在每一层都能得到该层平均因果作用的相合估计.在可忽略性假定下，平均因果作用可通过以下公式识别，$$E(Y_1-Y_0)= E[E(Y_1-Y_0\mid V)] = E[E(Y\mid X=1,V)-E(Y\mid X = 0,V)].$$

可忽略性假定解释了随机化试验和观察性研究的差别. 如果处理$X$没有随机分配，而仅仅是可忽略性假定成立，那么不对混杂因素进行调整，就会导致混杂偏倚，$$\begin{aligned}\label{bias}&&\{E(Y\mid X=1)-E(Y\mid X=0)\} - {\rm ACE}\\\nonumber&=& \int_V E(Y\mid X=1,V)\{\pr(V\mid X=1)-\pr(V)\}dV - \int_V E(Y\mid X=0, V)\{\pr(V\mid X=0)-\pr(V)\}dV.\end{aligned}$$当协变量$V$的分布在处理组和对照组不均衡时，即$pr(V\mid X=1)\neq pr(V\mid X=0)$时，该混杂偏倚一般不为零，因此在进行平均因果作用的统计推断时，需要对协变量$V$做调整。

在可忽略性假定下，多种统计推断方法可以用来估计因果作用。例如，当$V$是一个有$K$个水平的离散变量时，可以先在$V$的每一层估计${\rm ACE}_ k=E(Y_1-Y_0\mid V=k)$,然后估计${\rm ACE}=\sum_{k=1}^{K}{\rm ACE}_ k\pr(V=k)$。但是当$V$是高维变量或连续型变量时，按$V$的值将总体分层会导致每一层的样本太少，增大估计的方差。在这种情况下，通常建立一些参数模型来估计因果作用。

### 3.3 倾向得分和匹配

为了消除协变量的分布在处理组和对照组之间的差异，匹配(matching)方法经常用在观察性研究中。匹配方法的目的是对每一个体匹配一个具有相同或相近协变量取值的个体集合，使得匹配得到的数据在处理组和对照组有相同的协变量分布，然后根据匹配数据推断因果作用。早期的匹配方法根据一个或几个协变量直接构造匹配集合(Cochran and Rubin,1973;Rubin,1973)。但是在很多应用中，协变量维数较高，难以决定根据哪些协变量构造匹配集合。Rosenbaum and Rubin(1983)提出了倾向得分匹配(propensity score matching)方法，根据一个一维的倾向得分构造匹配集合，目前已经是观察性研究中常使用的匹配方法。

定义3.1 倾向得分定义为条件概率$$\pi(V)=pr(X=1\mid V).$$

定理3.1 (Rosenbaum and Rubin,1983)如果给定协变量$V$时可忽略性成立，即，$Y_x\ind X\mid V$ 且 $0<\pr(X=1\mid V)<1$,那么，给定倾向得分$\pi(V)$时可忽略性也成立，即，$Y_x\ind X\mid \pi(V)$且$0<\pr\{X=1\mid \pi(V)\}<1$.

因此，可以利用倾向得分分层或匹配进行因果推断，从而避免了用高维协变量$V$进行分层或匹配的困难。给定样本中个体$i=1,\cdots,n$,采用Abadie and Imbens(2016)的做法，个体$i$根据倾向得分得到的匹配集合定义为$$\begin{aligned}\label{match}J(i)=\vert/\{j=1,\ldots n: X_j=1-X_i; \sum_{k:X_k=1-X_i} \delta\{|\pi(V_i)-\pi(V_k)|\leq |\pi(V_i)-\pi(V_j)| \} \leq M\vert/\}.\end{aligned}$$其中，$\delta\{\cdot\}$是示性函数，当括号中的条件满足时取值$1$,否则取值 $0$;$M$为整数，代表每一个体的匹配数据的个数，比如，$M=1$时得到$1:1$匹配。这个定义允许在构造匹配集合过程中放回已被使用的个体，并用在其他个体的匹配集合中。平均因果作用的匹配估计为$$\begin{aligned}\widehat \phi_{\rm psm} = \frac{1}{n} \sum_{i=1}^{n } (2X_i-1) (Y_i  - \frac{1}{M} \sum_{j\in J(i)} Y_j).\end{aligned}$$如果在实际中不知道真实的倾向得分，可以根据数据预先估计，然后用估计得到的倾向得分做匹配。常用的估计倾向得分方法包括logistic回归，或决策树等机器学习方法(Lee et al.2010)。

匹配方法还可以用来估计处理组的平均因果作用 $$\begin{aligned}
\widehat \phi_{\rm psm1} = \frac{1}{\sum_{i=1}^{n}X_i} \sum_{i=1}^{n } X_i (Y_i  - \frac{1}{M} \sum_{j\in J(i)} Y_j).\end{aligned}$$
在一定正则条件下，可以证明匹配估计的相合性和渐近正态性(Abadie and Imbens,2006,2016)。此外，还有一些有趣性质。例如，在一定条件下，使用倾向得分估计值进行匹配得到的平均因果作用估计的方差比使用倾向得分的真实值还小(Abadie and Inbens 2006,2016)。Austin(2008,2011);Stuart(2010)详细回顾了匹配方法在应用中的其他话题，例如，方差估计的方法，有放回 (replacement)匹配和无放回匹配的比较，精确匹配，最近邻法匹配 (nearest neighbor matching)，检验匹配数据平衡性的方法，统计软件实现等等。

### 3.4 逆概加权估计和回归估计

除了匹配，倾向得分还经常用在逆概加权估计 (inverse probability weighted estimation)中。给定可忽略性假定，容易证明，$$E(Y_x)=E\vert/\{\frac{\delta(X=x)Y}{\pr(X=x\mid V)}\vert/\},$$

这里的$\delta(\cdot)$是示性函数。据此，可以通过拟合一个倾向得分模型 $\pi(V;\alpha)= \pr(X=1\mid V;\alpha)$
来估计平均因果作用。倾向得分模型满足相应的矩方程 $E\{X-\pi(X;\alpha)\mid V\}=0$,因此可以用经典的方法，如广义矩估计 (generalized method of moments, GMM,Hall(2005);Hansen(1982))来估计未知参数$\alpha$。得到参数估计 $\widehat\alpha$ 后，平均因果作用的逆概加权估计为$$\begin{aligned}\label{ipw}\widehat \phi_{\rm ipw} = \frac{1}{n} \sum_{i=1}^{n} \frac{X_iY_i}{\pi(V_i;\widehat\alpha)} -  \frac{1}{n} \sum_{i=1}^{n} \frac{(1-X_i)Y_i}{1-\pi(V_i;\widehat\alpha)}.\end{aligned}$$

回归估计 (regression-based estimator)需要建立一个对结果变量的回归模型，$E(Y\mid X,V)=m(X,V;\gamma)$。为了估计平均因果作用，需要先估计该模型的参数。注意到该回归模型满足矩方程 $E\{Y-m(X,V;\gamma)\mid X,V\}=0$，可以用经典的估计矩方程的方法来估计未知参数$\gamma$。在得到参数估计$\widehat\gamma$后，平均因果作用的回归估计为$$\begin{aligned}\label{reg}\widehat \phi_{\rm reg} =\frac{1}{n} \sum_{i=1}^{n}  X_i m(1,V_i;\widehat \gamma) -  \frac{1}{n}\sum_{i=1}^{n} (1-X_i)m(0,V_i;\widehat \gamma).\end{aligned}$$

给定可忽略性假定和一定的正则条件，容易证明，如果回归模型和倾向得分模型分别正确，并且$\widehat \gamma$和$\widehat \alpha$分别是$\gamma$和$\alpha$的相合估计，那么$\widehat \phi_{\rm reg}$ 和 $\widehat \phi_{\rm ipw}$是平均因果作用的相合估计(Horvitz and Thompson,1952;Robins et al.,1994)。回归估计和逆概加权估计方法被广泛应用在流行病学、生物医学、社会学经济学的因果推断中。这两种方法简捷明了，但是对模型特别敏感。当所需要的回归模型或者倾向得分模型不正确时，往往导致较大偏差。下面介绍的双稳健估计则利用回归估计和逆概加权估计互补，有效地缓解这两种方法各自的缺点。

### 3.5 双稳健估计

Robins et al.(1994);Rotnitzky et al.(1998)和Scharfstein et al.(1999)在研究缺失数据时提出了双稳健估计方法(doubly robust estimation)。这种方法把回归估计和逆概加权估计结合起来,并具有双稳健性质：只要回归模型和倾向得分模型中的一个模型正确，那么双稳健估计就有相合性。

双稳健估计同时需要一个回归模型$m(X,V;\gamma)=E(Y\mid X,V;\gamma)$和一个倾向得分模型$\pi(V;\alpha)=\pr(X=1\mid V;\alpha)$。估计未知参数$(\alpha,\gamma)$的方法如3.4节所述。得到参数估计$(\widehat \alpha,\widehat \gamma)$后，平均因果作用的双稳健估计为$$\begin{aligned}\label{dr}\widehat \phi_{\rm dr} &=&  \frac{1}{n}\sum_{i=1}^{n} \frac{X_i}{\pi(V_i;\widehat\alpha)} Y_i   -  \frac{1}{n} \sum_{i=1}^{n} \frac{1-X_i}{1-\pi(V_i;\widehat\alpha)} Y_i \nonumber \\&&+ \frac{1}{n} \sum_{i=1}^{n}\{ 1- \frac{X_i}{\pi(V_i;\widehat\alpha)}\} m(1,V_i;\widehat \gamma) -  \frac{1}{n} \sum_{i=1}^{n}\{1- \frac{1-X_i}{1-\pi(V_i;\widehat\alpha)}\} m(0,V_i;\widehat \gamma).\end{aligned}$$上式的第一行等于逆概加权估计，第二行是对逆概加权估计的一个纠偏项，由逆概的残差和回归估计构成。如果倾向得分模型正确，那么逆概加权估计有相合性，并且当样本量增加时第二行中的纠偏项趋于零。这是因为，根据大数定律，上式中的第三项收敛到$$\begin{aligned}E[\{ 1- \frac{X}{\pi(V;\alpha)}\}m(1,V;\gamma^*)\mid V]=E[ m(1,V;\gamma^*)E\{\frac{\pi(V;\alpha)-X}{\pi(V;\alpha)}\mid V\}]=0,\end{aligned}$$其中的$\gamma^*= \text{plim } \widehat\gamma$,表示当样本量趋于无穷时$\widehat\gamma$依概率收敛的极限值。同理第四项也收敛到$0$。因此，$\widehat \phi_{\rm dr}$在倾向得分模型$\pi(V;\alpha)$正确时有相合性。注意，当回归模型$m(X,V;\gamma)$错误时，上面的推导仍然成立。

式[\[dr\]](#dr){reference-type="eqref" reference="dr"}中的双稳健估计还可以等价地表示为$$\begin{aligned}\label{dr2}\widehat \phi_{\rm dr} &=&  \frac{1}{n}\sum_{i=1}^{n} m(1,V_i;\widehat \gamma) - \frac{1}{n} \sum_{i=1}^{n}m(0,V_i;\widehat \gamma) \nonumber \\&&+ \frac{1}{n} \sum_{i=1}^{n} \frac{X_i}{\pi(V_i;\widehat\alpha)} \{Y_i - m(1,V_i;\widehat \gamma)\} -  \frac{1}{n} \sum_{i=1}^{n}\frac{1-X_i}{1-\pi(V_i;\widehat\alpha)} \{Y_i- m(0,V_i;\widehat \gamma)\}.\end{aligned}$$式[\[dr2\]](#dr2){reference-type="eqref" reference="dr2"}中的第一行是回归估计，第二行是对回归估计的一个纠偏项。如果回归模型正确，那么回归估计有相合性，而且可以证明，无论倾向得分模型正确与否，当样本量增加时[\[dr2\]](#dr2){reference-type="eqref"reference="dr2"}式中第二行中的纠偏项趋于零，因此，$\widehat \phi_{\rm dr}$在回归模型正确时有相合性，而不需要倾向得分模型正确。

综上，$\widehat\phi_{\rm dr}$具有双稳健性质。相比于回归估计和倾向得分估计，双稳健估计提供了更多减少估计偏差的机会。由于双稳健估计能有效地减小模型错误导致的偏差，这种方法越来越广泛应用在缺失数据分析和因果推断中。关于双稳健估计理论性质的进一步研究和总结见Robins and Rotnitzky(2001);Van der Laan and Robins(2003)和Tsiatis(2006)。在假定可忽略性的条件下，双稳健估计的构造方法被迅速扩展(Bang and Robins,2005;Lipsitz et al.,1999;Lunceford and Davidian,2004;Robins et al.,2000)。但是，在可忽略性假定不满足时，倾向得分模型依赖未完全观测的潜在结果，联合分布的识别性得不到保证。此时，双稳健估计的构造比较困难，通常需要很强的倾向得分模型假定(Vansteelandt et al.,2007)。最近，Liu et al.(2018);Miao and Tchetgen(2016);Sun et al.(2018)提出使用辅助变量构造双稳健估计的方法。这些方法使用辅助变量提高联合分布的识别性和估计倾向得分模型，从而避免了过强的模型假定。

但是要注意到，当两个模型都不正确时，[\[dr\]](#dr){reference-type="eqref"reference="dr"}或[\[dr2\]](#dr2){reference-type="eqref"reference="dr2"}的双稳健估计可能会比回归估计和逆概加权估计的偏差更大。当出现特别大或者特别小的倾向得分时，偏差会被放大，甚至出现不合理的估计结果。例如，对一个取$0,1$值的结果变量，当两个模型都错误时，双稳健估计可能会得到大于$1$的结果。详细的讨论和例子见Kang and Schafer(2007)。针对这些缺陷的改进方法，见Robins et al.(2007);Tan(2010);Vermeulen and Vansteelandt(2015)等人的讨论。

## 4 未观测的混杂因素和潜在可忽略性

匹配，逆概加权，回归，和双稳健估计方法的重要前提是可忽略性假定。然而，在实际研究中，如果有重要背景变量未被观测，测量误差，或者选择偏差，就有潜在的未观测的混杂因素，可忽略性假定可能不成立，前一节介绍的统计推断方法在出现未观测的混杂因素时就有偏差。

当存在未被观测的混杂因素时，更合理的假定是潜在可忽略性：存在未被观测的变量$U$满足$Y_x\ind X\mid (U,V)$，其中$V$为观测的混杂因素。为了记号简略，在本节我们省略掉观测的混杂因素$V$。

假定4.1（潜在可忽略性）[]{#latent label="latent"} $Y_x\ind X\mid U$.在$U$是常数时，此假定退化为可忽略性假定。在潜在可忽略性假定下，$$E(Y_x)=E\{E(Y\mid X=x,U)\}\neq E(Y\mid X=x).$$。如果$U$没有被观测，那么 $E(Y\mid X=x,U)$ 一般不能由观测数据识别，因此$E(Y_x)$的识别性不能保证。如果用$E(Y\mid X=x)$来估计$E(Y_x)$就产生偏差。在潜在可忽略性假定下，辅助变量经常被用来帮助识别因果作用和消除混杂偏倚。辅助变量通常只和$(X,Y,U)$三个变量的一个子集相关，因此引入一些条件独立性帮助识别因果作用。在本节，我们介绍在潜在可忽略性假定下用来消除混杂偏差的两种方法，一种是常用的工具变量 (instrumental variable)方法，一种是最近引起人们注意的阴性对照变量 (negative control variable)方法。

### 4.1 工具变量估计

用$Z$表示一个工具变量,$U$表示未观测的混杂因素，工具变量的定义包含三个核心条件：

假定4.2[]{#def:iv label="def:iv"} $(i)$ $Z\ind Y\mid (X,U)$; $(ii)$ $Z\ind U$;$(iii)$ $Z\nind X$。

当存在完全观测的协变量$V$时，以上的三个条件改为在给定$V$条件下成立。条件$(i)$表示工具变量$Z$对$Y$无直接作用，条件$(ii)$表示工具变量和未观测的混杂因素独立，条件$(iii)$ 表示工具变量和处理相关。当工具变量$Z$是发生在$X$之前的一种处理或暴露变量时，则可以定义潜在接受的处理$X_z$和潜在结果$Y_{z,x}$。例如，在临床试验中，由于病人存在不依从性，医生随机分配的处理(assignment)$Z$会影响，但可能不同于病人实际接受的处理(treatment)$X$；病人治疗结果变量$Y$只依赖于实际接受的处理，而不受处理分配的影响。此时，处理分配$Z$可以作为工具变量，满足下面的条件：

假定4.3[]{#def:iv2 label="def:iv2"} $(i)$ $Y_{z,x}=Y_x$; $(ii)$$Y_{z,x}\ind Z$; $(iii)$ $Z\nind X$。

给定这三个条件，平均因果作用仍然不可识别，但是可以求平均因果作用的上下界，也称为部分可识别性(partial identification)。(Balke and Pearl,1997;Manski,1990;Richardson et al.,2011)研究了平均因果作用在条件$(i)$--$(iii)$下的上下界。但是这些界通常仍然比较宽，在实际研究中不足以得到很确定的因果推论。因此，人们通常引入一些模型假定，这些假定能进一步缩短因果作用的界或者识别因果作用。

除了需要条件 $(i)$--$(iii)$，有两种常用的假定被用在工具变量的分析中Hernan and Robins,2018,section 16]:一种是因果作用的同质性假定 (effect homogeneity),一种是单调性假定 (monotonicity)。同质性假定最常用的版本即为在经济学和社会学中广泛应用的结构方程模型 (structural equation model)。工具变量被用来估计结构方程中处理或暴露变量的回归系数(Wright,1928;Goldberger,1972;Wooldridge,2010)。例如，连续型结果变量的线性模型 $$\begin{aligned}Y&=&\beta_0+\beta_1 X+ U,\end{aligned}$$ 其中，$U$是未观测的混杂因素，$\beta_1$表示在其他因素$(U)$不变的情况下，$X$每增加一个单位对$Y$的作用(ceteris paribus effect)。这个方程实际上假定$X$对$Y$的作用在所有人当中是一个常数.这个方程也可以等价地用潜在结果表示为$$Y_x= \beta_0+\beta_1 x+ U.$$此模型隐含了潜在可忽略性假定 [\[latent\]](#latent){reference-type="ref"reference="latent"}。在此模型下，$\beta_1$代表平均因果作用$E(Y_1-Y_0)$。由于存在未观测的混杂因素，那么仅从结构方程不能识别$\beta_1$。例如，当$E(U\mid X)\neq 0$时，$\beta_1$的最小二乘估计有偏.但是利用工具变量，可以识别$\beta_1$。利用一个满足假定 [\[def:iv\]](#def:iv){reference-type="ref"reference="def:iv"}的工具变量$Z$，可以验证 $\beta_1= \sigma_{yz}/\sigma_{xz}$。给定观测数据，把样本协方差 $\widehat \sigma_{yz},\widehat \sigma_{xz}$带入，即得到 $\beta_1$ 的工具变量估计 (instrumental variable estimator), $$\begin{aligned}\label{iv2}\beta_1^{\rm iv}= \frac{\widehat\sigma_{yz}}{\widehat \sigma_{xz}}.\end{aligned}$$即使 $E(U\mid X)\neq 0$，在假定 $(i)$--$(iii)$和一定的正则条件下，可以证明$\beta_1^{\rm iv}$的相合性和渐近正态性(Wooldridge,2010,section 5)。工具变量方法有效地缓解了未观测的混杂因素导致的偏差。

比常数作用假定稍弱的是Hernan and Robins(2006)提出的无修正作用假定：$E(Y_1-Y_0\mid Z,X)=E(Y_1-Y_0\mid X)$。在此假定下，可以识别处理组的平均因果作用$E(Y_1-Y_0\mid X=1)$。质性假定在实际中难以论证是否成立，此外，结构方程模型需要参数模型，对模型的错误设定敏感。Hernan and Robins(2006)讨论了这些模型和假定在实际应用中，特别是在流行病学研究中的局限性。

不同于同质性假定，单调性假定要求$Z$对$X$的作用单调。单调性假定在很多情况下更合理。例如，在研究药效的临床试验中，由于病人存在不依从性，病人实际接受的处理(treatment,$X$)和医生分配的处理(assignment,$Z$)不完全相同，但可以合理地假定单调性：所有个体潜在接受的处理都满足$X_{z=1}\geq X_{z=0}$。在此假定下，Angrist et al.(1996);Imbens and Angrist(1994)证明了可以使用 $Z$作为工具变量识别依从组(即满足 $X_{z=1}=1,X_{z=0}=0$的个体)的平均因果作用 (compliers average causal effect)：$E(Y_{x=1}-Y_{x=0}\mid X_{z=1}=1,X_{z=0}=0)$。

工具变量已被广泛应用在经济学、社会学、流行病学和生物统计学的观察性研究中，这方面的研究数不胜数。与因果推断密切相关的问题包括，半参数和非参数结构方程模型的估计(Ai and Chen,2003;Newey and Powell,2003)，在二值结果变量模型中的应用(Clarke and Windmeijer,2012;Vansteelandt et al.,2011),孟德尔随机化研究 (Mendelian randomization)中的应用Burgess et al.,2017),弱工具变量的问题(Bound et al.,1995;Stock et al.,2002)。工具变量最近的综述性文章包括Baiocchi et al.(2014);Clarke and Windmeijer(2012)。

### 4.2 阴性对照变量方法

工具变量估计对假定[\[def:iv\]](#def:iv){reference-type="ref" reference="def:iv"}的条件$(i)$--$(iii)$很敏感。假定[\[def:iv\]](#def:iv){reference-type="ref" reference="def:iv"}的条件$(i)$需要有专业知识保证工具变量对结果变量没有直接作用，条件$(iii)$可以用观测数据检验，但是条件$(ii)$难以验证，因为混杂因素$U$没有观测到。用plim $\beta_1^{\rm iv}$表示当样本量趋于无穷时$\beta_1^{\rm iv}$依概率收敛的极限。当条件$(ii)$不满足时，工具变量估计的渐近偏差是$$\begin{aligned}{\rm plim }\, \beta_1^{\rm iv} -\beta_1 =\frac{\sigma_{uz}}{\sigma_{xz}}.\end{aligned}$$由此可见，当$\sigma_{uz}\neq0$时，工具变量估计不相合，而且偏差会由于$\sigma_{xz}$过小而被放大很多倍。我们介绍使用阴性对照变量(negative control variable)方法解决这些问题。

阴性对照变量是与混杂因素$U$相关，但与处理$X$或结果变量$Y$无因果关系的辅助变量。阴性对照变量分为两种：阴性对照暴露和阴性对照结果。前者是一个辅助的暴露变量，但是对关心的结果没有直接的因果作用；后者是一个辅助的结果变量，但是不受暴露变量的影响。这些特点可以严格的表述如下。

假定4.4（阴性对照结果，negative control outcome)[]{#nco label="nco"}一个结果变量$W$称为一个阴性对照结果，如果它满足$W\ind X \mid U$和$W\nind U$。

假定4.5（阴性对照暴露，negative control exposure)[]{#nce label="nce"}一个暴露变量$Z$称为一个阴性对照暴露，如果它满足$Z\ind Y \mid (U,X)$ 和 $Z\ind W \mid (U,X)$。

除了要求阴性对照变量$Z$和$W$与处理或结果变量无直接的因果关系，上面的定义还要求$Z$与$(W,Y)$之间的混杂因素和$X$与$(W,Y)$之间的混杂因素相同。当存在完全观测的协变量$V$时，上述定义中的条件独立性需要给定$V$。阴性对照暴露的定义类似工具变量中的无直接作用条件，但是对$(Z,U)$的相关性不做要求，因此工具变量可看做阴性对照暴露的特例。

在流行病学中，阴性对照变量在很长时间内被用作检测混杂因素是否存在(Berkson,1958;Flanders et al.,2011;Hill,1965;Rosenbaum,1989;Weiss,2002;Yerushalmy and Palmer,1959)。例如，在一项关于突发压力对心脏病的危害的研究中，Trichopoulos et al.(1983)发现，在雅典1981地震后短时间内由心脏病导致的死亡增加，为了验证是否存在未观测的混杂因素，他们又分析了癌症死亡数据，发现癌症导致的死亡没有明显增加。这样的结果表明，没有明显的混杂作用，也间接地支持了地震带来的突发压力增加心脏病风险的结论。在这一例子中，癌症死亡率作为阴性对照结果用来检验是否存在未观测的混杂。Lipsitch et al.(2010);Rosenbaum(1989;2002)回顾了使用阴性对照变量检测混杂的方法。在流行病学和生物统计研究中，阴性对照变量还被用来校正混杂导致的偏差(Flanders et al.,2011;Gagnon-Bartsch and Speed,2012;Schuemie et al.,2014;Soft et al.,2016),但这些方法通常需要很强的模型假定。如何使用阴性对照变量得到确定性的因果推论和识别因果作用，目前的研究很少。

最近，Miao et al.(2018);Miao and Tchetgen Tchetgen(2017,2018)系统地研究了用阴性对照变量识别因果作用的方法和所需要的条件。Miao and Tchetgen Tchetgen(2018)引入的混杂桥函数 (confounding bridge function)为使用阴性对照变量识别因果作用奠定了基础。

假定4.6[]{#link label="link"}存在一个函数$h$，对所有$x$都有$$E (Y\mid U,X=x)  =E\{ h(W,X=x)\mid U\}.$$

当存在协变量$V$时，该假定为：$E (Y\mid U,V,X=x)  =E\{ h(W,V,X=x)\mid U,V\}$。混杂桥函数描述的是混杂因素对关心的结果变量和对阴性对照结果的作用之间的关系。例如，当$E(Y\mid U,X)=\beta_1  X+U$ 且 $E(W\mid U)$是$U$的线性模型时，混杂桥函数是一个线性可加函数$h(W,X;\gamma)=\gamma_0+\gamma_1 X +\gamma_2W$,其中的参数由数据产生机制$E(Y\mid U,X)$ 和 $E(W\mid U)$决定。

在假定[\[latent\]](#latent){reference-type="ref" reference="latent"},[\[nco\]](#nco){reference-type="ref"reference="nco"}--[\[link\]](#link){reference-type="ref"reference="link"}下，容易得到$$\begin{aligned}\label{eq:idn}E(Y_x) & = &  E\{h(W,X=x)\}.\end{aligned}$$可见，使用混杂桥函数，潜在结果的均值可以由阴性对照结果的分布表示出来。如果已知$h$函数，那么$E(Y_x)$可以根据[\[eq:idn\]](#eq:idn){reference-type="eqref" reference="eq:idn"}识别，进而平均因果作用可以识别。例如，$h$满足线性模型时$h(W,X;\gamma)=\gamma_0+\gamma_1 X +\gamma_2W$,那么 $\gamma_1$就等于平均因果作用。在实际研究中，如果$h$是未知函数，可以利用一个阴性对照暴露识别$h$。

由假定[\[nce\]](#nce){reference-type="ref" reference="nce"}和[\[link\]](#link){reference-type="ref" reference="link"}可得$$\begin{aligned}\label{eq:intg}E(Y\mid Z,X)=E\{h(W,X)\mid Z,X\}.\end{aligned}$$式 [\[eq:intg\]](#eq:intg){reference-type="eqref" reference="eq:intg"}中只涉及观测数据的分布和未知的混杂桥函数$h$,因此提供了识别$h$的基础。此外，还需要如下的完备性条件。

假定4.7（完备性）[]{#cndt:cmp label="cndt:cmp"}对任意$x$,条件分布$\pr(W\mid Z,X=x)$满足：对所有的平方可积函数$g$,如果$E\{g(W)\mid Z,X=x\}=0$几乎处处成立,那么$g(W)$几乎处处为零。

完备性条件是研究识别性问题中普遍需要的条件。作为特例，对一个二值的混杂因素，只要$U\nind Z\mid X=x$对任意$x$成立，那么假定[\[cndt:cmp\]](#cndt:cmp){reference-type="ref" reference="cndt:cmp"}一定成立。此外，完备性条件在很多模型下成立，例如，指数族分布(Newey and Powell,2003)。关于完备性条件的讨论见Andrews(2017);Chen et al.(2014);Darolles et al.(2011);Newey and Powell(2003)。

定理4.1(Miao and Tchetgen Tchetgen,2018)[]{#thm:idn2 label="thm:idn2"}在假定[\[latent\]](#latent){reference-type="ref" reference="latent"},[\[nco\]](#nco){reference-type="ref"reference="nco"}--[\[cndt:cmp\]](#cndt:cmp){reference-type="ref"reference="cndt:cmp"}下，方程[\[eq:intg\]](#eq:intg){reference-type="eqref" reference="eq:intg"}有唯一解$h$;把此解带入 [\[eq:idn\]](#eq:idn){reference-type="eqref"reference="eq:idn"},则$E(Y_x)$可识别。

至此，通过引入混杂桥函数，使用阴性对照变量已经可以识别 $E(Y_x)$和平均因果作用。

在使用实际数据估计因果作用时，可以对混杂桥函数建立参数化模型$h(W,X;\gamma)$，然后用广义矩方法或者两步最小二乘估计$\gamma$和平均因果作用。以线性模型为例，假设$E(Y\mid X,U)=\beta_1X+U$,那么我们采用线性可加的混杂桥函数$h(W,X;\gamma)=\gamma_0+\gamma_1 X +\gamma_2W$,并用两步最小二乘方法估计 $\beta_1$:第一步用$W$对$(Z,X)$做回归得到$\widehat W$,第二步用$Y$对$(\widehat W,X)$做回归。那么第二步回归中得到的$X$的系数估计即为$\beta_1$的相合估计，也是平均因果作用的相合估计。还可以证明，$\beta_1$的两步最小二乘方法估计等价于$$\beta_1^{\rm nc} =  \frac{\widehat \sigma_{xw}\widehat \sigma_{zy}-\widehat \sigma_{xy}\widehat \sigma_{zw}}{\widehat \sigma_{xw}\widehat \sigma_{xz}-\widehat \sigma_{xx}\widehat \sigma_{zw}}.$$此式可以看做式 [\[iv2\]](#iv2){reference-type="eqref" reference="iv2"}的推广。当$Z\ind U$,即$Z$是一个工具变量时，plim$\widehat \sigma_{zw}=0$,因此，plim $\beta_1^{\rm nc}=$ plim$\beta_1^{\rm iv}=\beta_1$;当$Z\nind U$时，plim$\beta_1^{\rm iv}\neq \beta_1$,但是，如果$E(W\mid U)$是$U$的线性模型，那么仍然有plim $\beta_1^{\rm nc}=\beta_1$。结果，使用阴性对照$W$有效地缓解了工具变量估计在假定$Z\ind U$不成立时的偏差。除了参数化模型，在复杂问题中还可以对$h(W,X)$建立半参数化或者非参数化的模型进行估计，这些都属于一大类条件矩模型 (conditional moment restriction model)的估计方法，已有很多标准的做法，见Ai and Chen(2003);Newey and Powell(2003)。

## 5 替代指标与中介分析

在科学研究中，特别是在医学和生物学试验中，当感兴趣的终点指标(endpoint)难以观测时，常会取而代之观测替代指(surrogate)或标记物(marker)。如何寻找或确定替代指标是一个尚未解决的问题。在医学临床试验中一些常用的替代指标遭到了质疑，一些论文(Alonso and Molenbergh,2008;Baker,2006;Fleming and Demets,1996;Manns et al.2006),指出了在临床试验中由于使用替代指标错误评价治疗效果的实例，例如，AIDS病临床试验中采用的替代指标CD4、预防骨质疏松采用的替代指标骨密度等。

目前有若干种确定替代指标的准则。最直观的准则是要求替代指标与终点指标有强相关性。但是，强相关的替代指标不意味着因果关系。例如，小孩鞋子尺寸与记忆的单词量有很强的正相关性，增加鞋子尺寸并不能增加单词量。Prentice(1989)提出统计替代指标的准则，除了要求替代指标与终点指标相关之外，还要求给定替代指标下处理(treatment)与终点指标条件独立。统计替代指标只是切断了处理与终点指标的相关关系，不能切断因果关系。Frangakis and rubin(2002)提出了切断处理与终点指标之间因果关系的主替代指标(principal surrogate),处理对替代指标没有因果作用的话，处理对终点指标就没有因果作用；即满足因果必要性。Lauritzen(2004)利用因果网络图提出了强替代指标的准则，要求强替代指标切断处理到终点指标的因果路径。Chen et al.(2007)提出了替代指标悖论，即处理（或称治疗）对替代指标有正的因果作用，并且替代指标对终点指标也有正的因果作用，但是该处理对终点指标有负的因果作用。例如，任何一个人假若心律正常一定比心律不正常活得更长，某种药可以显著纠正心律失常，但是这种药反而减少病人的寿命Moore(1995)。Chen et al.(2007)指出前面所述的准则都不能避免替代指标悖论的发生。令人惊讶的是，主替代指标和强替代指标有非常严格的要求条件，但是它们仍然不能避免替代指标悖论；替代指标悖论从根基上完全动摇了替代指标和标记物的价值(Vanderveelw,2013)。在VanderWeele(2013)的这篇文章之后，Elliott研究组、Joffe和Pearl讨论了替代指标悖论的重要性，共同认识到非常有必要重新定义和评价合理的替代指标及其准则，以避免替代指标悖论现象的发生。

### 5.1 替代指标悖论

Moore(1995)一书讲述了有关治疗心律失常药物导致美国数万人死亡的重大药物灾难。该药物灾难描述了一个替代指标悖论的真实例子。关于心律失常疾病，医生的知识是心律失常是猝死的危险因素，纠正心律失常能够预防猝死。因此，"纠正心律失常"作为一个替代指标，美国FDA批准了几种药物(Enkaid,Tambocor,Ethmozine)。后来通过上市后追踪研究，发现尽管这些药物能有效地纠正心律失常，但是反而增加了死亡率。

为了理解为什么会发生替代指标悖论，我们下面给出一个数值的例子说明主替代指标和强替代指标可能会发生替代指标悖论的现象。令$X$为二值的处理，1表示接受一种新的处理，0表示接受对照处理。$S$表示心律失常是否纠正，1表示纠正了，0表示未纠正。$S_x$表示接受处理$X=x$情况下是否纠正心律失常的潜在结果。$Y_{sx}$表示在处理$X=x$且心律失常纠正与否$S=s$情况下的潜在生存时间。假定处理$X$对生存时间$Y$的作用完全通过中间变量$S$起作用，即$Y_{sx}=Y_{sx'}=Y_s$。因此，当处理$X$对心律$S$没有个体因果作用$S_{X=1}=S_{X=0}=s$时，处理$X$对生存时间$Y$也没有因果作用$Y_{s1}=Y_{s0}$，即$S$是一个主替代指标，也是一个强替代指标。进一步假定纠正心律失常能延长每一位病人$i$的生存时间$Y_{S=0}(i)<Y_{S=1}(i)$。在这两个假定下，直观上似乎纠正心律失常可以作为生存时间的一个"理想"的替代指标。从统计意义上说，如果处理$X$能纠正心律失常$S$,就应该能"延长"病人的寿命$Y$。但是，这个直观是错误的。我们可以编造一个100位心律失常病人的总体，如表[1](#surrogate-tab){reference-type="ref"reference="surrogate-tab"}所示，来说明替代指标悖论的现象。100位病人分为四个主分层：$(S_0=0, S_1=0)$,$(S_0=0,S_1=1)$,$(S_0=1,S_1=0)$,$(S_0=1,S_1=1)$，如第3和4列所示。在每一主分层的病人人数如第2列所示。简单起见，假定在同一主分层的所有病人有相同的潜在生存时间，第5和6列给出了所有主分层中病人的潜在生存时间（年），其中有些是先验反事实的。例如，在第1层的是先验反事实的，这是因为不管接受对照治疗$T=0$，还是都接受处理$X=1$都不会得到$S=1$，除非采用干预才可能得到。由第3到6列，可以得到潜在生存时间。由表1的100位病人的总体，可以得到处理$X$对纠正心律失常$S$的平均因果作用为：假若100人都接受处理$X=1$时纠正心律失常的比率与假若100人都接受对照$X=0$时纠正心律失常的比率之差，$$ACE_{X \rightarrow S} = \frac{40+20}{100} - \frac{20+20}{100} =\frac{20}{100} > 0,$$ 表明处理$X$对纠正心律失常$S$有正的因果作用。而处理$X$对生存时间$Y$的因果作用为：假若100人都接受处理$X=1$时的平均寿命与假若100人都接受对照$X=0$时的平均寿命之差，$$ACE_{X \rightarrow Y} = \frac{3\cdot 20+ 7\cdot 40 + 5\cdot 20+10\cdot 20}{100}-\frac{3\cdot 20 + 6\cdot 40 + 8\cdot 20 + 10 \cdot 20}{100}= - \frac{20}{100}<0.$$表明处理$X$对病人寿命$Y$有负的因果作用。这个例子说明了纠正心律失常$S$作为一个主替代指标和强替代指标，导致了替代指标悖论的现象，不能正确地评价处理$X$对寿命$Y$的作用。这个例子说明了因果作用的统计结论不具有传递性。处理$X$对纠正心律失常$S$的平均因果作用为正，纠正心律失常$S$对寿命$Y$的个体因果作用为正，但是处理$X$对寿命$Y$的平均因果作用为负。
